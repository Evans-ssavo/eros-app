<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EROS ‚Äî Emergency Response Optimization System</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #080c0f;
    --bg2: #0d1318;
    --bg3: #111920;
    --border: #1a2a35;
    --border2: #1e3040;
    --red: #ff2d2d;
    --orange: #ff7b00;
    --yellow: #ffc107;
    --green: #00e676;
    --cyan: #00d4ff;
    --text: #c8d8e0;
    --text-dim: #4a6070;
    --text-bright: #e8f4fa;
    --font-head: 'Rajdhani', sans-serif;
    --font-mono: 'Share Tech Mono', monospace;
    --font-body: 'Exo 2', sans-serif;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-body);
    min-height: 100vh;
    overflow-x: hidden;
    padding-bottom: 28px;
  }
  body::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
    pointer-events: none;
    z-index: 9999;
  }

  nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    height: 60px;
    background: var(--bg2);
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .nav-logo {
    font-family: var(--font-head);
    font-size: 1.4rem;
    font-weight: 700;
    letter-spacing: 3px;
    color: var(--cyan);
    text-shadow: 0 0 20px rgba(0,212,255,0.4);
  }
  .nav-logo span { color: var(--red); }
  .nav-tabs { display: flex; gap: 0.5rem; }
  .nav-tab {
    padding: 0.4rem 1.2rem;
    background: transparent;
    border: 1px solid var(--border2);
    color: var(--text-dim);
    font-family: var(--font-head);
    font-size: 0.85rem;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
  }
  .nav-tab:hover { color: var(--cyan); border-color: var(--cyan); }
  .nav-tab.active { color: var(--cyan); border-color: var(--cyan); background: rgba(0,212,255,0.07); }
  .status-dot {
    display: flex; align-items: center; gap: 0.5rem;
    font-family: var(--font-mono); font-size: 0.75rem; color: var(--green);
  }
  .status-dot::before {
    content: ''; width: 8px; height: 8px; border-radius: 50%;
    background: var(--green); box-shadow: 0 0 10px var(--green);
    animation: pulse 2s infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

  .page { display: none; padding: 2rem; min-height: calc(100vh - 88px); }
  .page.active { display: block; animation: fadeIn 0.3s ease; }
  @keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

  /* ---- SOS ---- */
  .sos-container {
    display: flex; flex-direction: column; align-items: center;
    justify-content: center; min-height: calc(100vh - 148px);
    gap: 2.5rem; text-align: center;
  }
  .sos-title { font-family: var(--font-head); font-size: 1rem; letter-spacing: 6px; color: var(--text-dim); text-transform: uppercase; }
  .sos-btn-wrap { position: relative; width: 240px; height: 240px; display: flex; align-items: center; justify-content: center; }
  .sos-ring { position: absolute; border-radius: 50%; border: 1px solid var(--red); opacity: 0.3; animation: ringPulse 2.5s infinite; }
  .sos-ring:nth-child(1){width:100%;height:100%;animation-delay:0s}
  .sos-ring:nth-child(2){width:80%;height:80%;animation-delay:0.5s}
  .sos-ring:nth-child(3){width:60%;height:60%;animation-delay:1s}
  @keyframes ringPulse { 0%,100%{transform:scale(1);opacity:0.3} 50%{transform:scale(1.05);opacity:0.1} }
  .sos-button {
    width: 160px; height: 160px; border-radius: 50%;
    background: radial-gradient(circle at 35% 35%, #ff5555, #c00 60%, #700 100%);
    border: 3px solid var(--red); color: white;
    font-family: var(--font-head); font-size: 2rem; font-weight: 700; letter-spacing: 4px;
    cursor: pointer; position: relative; z-index: 1;
    box-shadow: 0 0 40px rgba(255,45,45,0.4), inset 0 2px 4px rgba(255,255,255,0.1);
    transition: all 0.15s; user-select: none;
  }
  .sos-button:hover { transform: scale(1.05); box-shadow: 0 0 70px rgba(255,45,45,0.6), inset 0 2px 4px rgba(255,255,255,0.1); }
  .sos-button:active { transform: scale(0.96); }
  .sos-button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
  .sos-button.triggered { animation: sosTrigger 0.5s ease; }
  @keyframes sosTrigger { 0%{transform:scale(1)} 30%{transform:scale(1.15);box-shadow:0 0 120px rgba(255,45,45,1)} 100%{transform:scale(1)} }
  .sos-subtitle { font-size: 0.8rem; color: var(--text-dim); font-family: var(--font-mono); }
  .sos-info-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 1rem; width: 100%; max-width: 600px; }
  .sos-info-card { background: var(--bg2); border: 1px solid var(--border); padding: 1rem; text-align: center; }
  .sos-info-card .label { font-size: 0.7rem; color: var(--text-dim); font-family: var(--font-mono); letter-spacing: 2px; margin-bottom: 0.4rem; }
  .sos-info-card .value { font-family: var(--font-head); font-size: 1.1rem; font-weight: 600; color: var(--cyan); }
  .sos-alert { background: rgba(255,45,45,0.1); border: 1px solid var(--red); padding: 1rem 2rem; font-family: var(--font-mono); font-size: 0.85rem; color: var(--red); width: 100%; max-width: 600px; display: none; text-align: center; }
  .sos-alert.show { display: block; animation: fadeIn 0.3s ease; }

  /* ---- MAP ---- */
  .map-layout { display: grid; grid-template-columns: 1fr 320px; gap: 1.5rem; height: calc(100vh - 148px); }
  .map-canvas { background: var(--bg2); border: 1px solid var(--border); position: relative; overflow: hidden; }
  .map-grid { position: absolute; inset: 0; background-image: linear-gradient(rgba(0,212,255,0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(0,212,255,0.04) 1px, transparent 1px); background-size: 40px 40px; }
  .map-roads { position: absolute; inset: 0; }
  .map-roads svg { width: 100%; height: 100%; }
  .incident-pin { position: absolute; transform: translate(-50%,-50%); cursor: pointer; z-index: 10; }
  .incident-pin .pin-dot { width: 14px; height: 14px; border-radius: 50%; border: 2px solid; position: relative; z-index: 1; }
  .incident-pin .pin-ripple { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); width: 14px; height: 14px; border-radius: 50%; animation: ripple 1.5s infinite; }
  .incident-pin .pin-label { position: absolute; top: -28px; left: 50%; transform: translateX(-50%); font-family: var(--font-mono); font-size: 0.65rem; white-space: nowrap; padding: 2px 6px; background: var(--bg2); border: 1px solid; }
  .pin-critical .pin-dot{background:var(--red);border-color:var(--red);box-shadow:0 0 12px var(--red)}
  .pin-critical .pin-ripple{border:2px solid var(--red)}
  .pin-critical .pin-label{color:var(--red);border-color:var(--red)}
  .pin-medium .pin-dot{background:var(--orange);border-color:var(--orange);box-shadow:0 0 12px var(--orange)}
  .pin-medium .pin-ripple{border:2px solid var(--orange)}
  .pin-medium .pin-label{color:var(--orange);border-color:var(--orange)}
  .pin-low .pin-dot{background:var(--yellow);border-color:var(--yellow);box-shadow:0 0 8px var(--yellow)}
  .pin-low .pin-ripple{border:2px solid var(--yellow)}
  .pin-low .pin-label{color:var(--yellow);border-color:var(--yellow)}
  @keyframes ripple{0%{width:14px;height:14px;opacity:1}100%{width:40px;height:40px;opacity:0}}
  .map-sidebar { display: flex; flex-direction: column; gap: 1rem; overflow-y: auto; }
  .map-sidebar::-webkit-scrollbar{width:4px}
  .map-sidebar::-webkit-scrollbar-thumb{background:var(--border2)}
  .panel { background: var(--bg2); border: 1px solid var(--border); }
  .panel-header { padding: 0.7rem 1rem; border-bottom: 1px solid var(--border); font-family: var(--font-head); font-size: 0.8rem; letter-spacing: 3px; color: var(--text-dim); text-transform: uppercase; display: flex; align-items: center; justify-content: space-between; }
  .panel-body { padding: 0.75rem; }
  .incident-item { padding: 0.7rem; border: 1px solid var(--border); margin-bottom: 0.5rem; cursor: pointer; transition: border-color 0.2s; position: relative; }
  .incident-item:hover { border-color: var(--cyan); }
  .incident-item:last-child { margin-bottom: 0; }
  .incident-item .inc-type { font-family: var(--font-head); font-size: 0.9rem; font-weight: 600; margin-bottom: 0.2rem; }
  .incident-item .inc-meta { font-family: var(--font-mono); font-size: 0.65rem; color: var(--text-dim); }
  .inc-badge { position: absolute; top: 0.5rem; right: 0.5rem; font-family: var(--font-mono); font-size: 0.6rem; padding: 2px 6px; border: 1px solid; }
  .badge-critical{color:var(--red);border-color:var(--red);background:rgba(255,45,45,0.1)}
  .badge-medium{color:var(--orange);border-color:var(--orange);background:rgba(255,123,0,0.1)}
  .badge-low{color:var(--yellow);border-color:var(--yellow);background:rgba(255,193,7,0.1)}
  .add-inc-form { display: flex; flex-direction: column; gap: 0.5rem; }
  .add-inc-form select, .add-inc-form input { background: var(--bg3); border: 1px solid var(--border2); color: var(--text); padding: 0.5rem; font-family: var(--font-mono); font-size: 0.8rem; outline: none; transition: border-color 0.2s; }
  .add-inc-form select:focus, .add-inc-form input:focus { border-color: var(--cyan); }
  .btn-add { padding: 0.5rem; background: rgba(0,212,255,0.1); border: 1px solid var(--cyan); color: var(--cyan); font-family: var(--font-head); font-size: 0.8rem; letter-spacing: 2px; cursor: pointer; transition: all 0.2s; text-transform: uppercase; }
  .btn-add:hover { background: rgba(0,212,255,0.2); }

  /* ---- ADMIN ---- */
  .admin-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 1rem; margin-bottom: 1.5rem; }
  .stat-card { background: var(--bg2); border: 1px solid var(--border); padding: 1.2rem; position: relative; overflow: hidden; }
  .stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%; }
  .stat-card.c-red::before{background:var(--red);box-shadow:0 0 10px var(--red)}
  .stat-card.c-orange::before{background:var(--orange)}
  .stat-card.c-green::before{background:var(--green)}
  .stat-card.c-cyan::before{background:var(--cyan)}
  .stat-label { font-size: 0.7rem; color: var(--text-dim); font-family: var(--font-mono); letter-spacing: 2px; margin-bottom: 0.5rem; }
  .stat-value { font-family: var(--font-head); font-size: 2.2rem; font-weight: 700; color: var(--text-bright); line-height: 1; }
  .stat-sub { font-size: 0.7rem; color: var(--text-dim); margin-top: 0.3rem; font-family: var(--font-mono); }
  .admin-bottom { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
  .priority-bar-wrap { margin-bottom: 0.8rem; }
  .priority-bar-label { display: flex; justify-content: space-between; font-family: var(--font-mono); font-size: 0.7rem; color: var(--text-dim); margin-bottom: 0.3rem; }
  .priority-bar-track { height: 6px; background: var(--bg3); position: relative; }
  .priority-bar-fill { height: 100%; transition: width 1s ease; }
  table { width: 100%; border-collapse: collapse; }
  thead tr { border-bottom: 1px solid var(--border2); }
  th { padding: 0.6rem 0.8rem; font-family: var(--font-head); font-size: 0.75rem; letter-spacing: 2px; color: var(--text-dim); text-align: left; text-transform: uppercase; }
  td { padding: 0.6rem 0.8rem; font-family: var(--font-mono); font-size: 0.75rem; border-bottom: 1px solid var(--border); }
  tr:hover td { background: rgba(0,212,255,0.03); }
  tr:last-child td { border-bottom: none; }

  /* ---- REPORT ---- */
  .report-wrap { max-width: 680px; margin: 0 auto; }
  .report-title { font-family: var(--font-head); font-size: 1.8rem; font-weight: 700; letter-spacing: 4px; color: var(--text-bright); margin-bottom: 0.5rem; }
  .report-desc { color: var(--text-dim); font-size: 0.85rem; margin-bottom: 2rem; line-height: 1.7; }
  .report-form { display: flex; flex-direction: column; gap: 1.2rem; }
  .form-group label { display: block; font-family: var(--font-head); font-size: 0.75rem; letter-spacing: 3px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 0.4rem; }
  .form-group input, .form-group textarea, .form-group select { width: 100%; background: var(--bg2); border: 1px solid var(--border2); color: var(--text); padding: 0.75rem 1rem; font-family: var(--font-body); font-size: 0.9rem; outline: none; transition: border-color 0.2s; resize: vertical; }
  .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: var(--cyan); box-shadow: 0 0 0 1px rgba(0,212,255,0.1); }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  .anon-notice { background: rgba(0,212,255,0.05); border: 1px solid rgba(0,212,255,0.2); padding: 0.8rem 1rem; font-size: 0.78rem; color: var(--cyan); font-family: var(--font-mono); display: flex; align-items: center; gap: 0.6rem; }
  .submit-btn { padding: 0.9rem; background: rgba(0,212,255,0.1); border: 1px solid var(--cyan); color: var(--cyan); font-family: var(--font-head); font-size: 1rem; letter-spacing: 4px; cursor: pointer; text-transform: uppercase; transition: all 0.2s; }
  .submit-btn:hover { background: rgba(0,212,255,0.2); box-shadow: 0 0 20px rgba(0,212,255,0.15); }
  .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .report-success { display: none; text-align: center; padding: 3rem; border: 1px solid var(--green); background: rgba(0,230,118,0.05); }
  .report-success.show { display: block; animation: fadeIn 0.4s ease; }
  .success-icon { font-size: 3rem; color: var(--green); margin-bottom: 1rem; }
  .success-id { font-family: var(--font-mono); font-size: 0.85rem; color: var(--text-dim); margin-top: 0.5rem; }

  /* ---- FOOTER ---- */
  .footer-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 28px; background: var(--bg2); border-top: 1px solid var(--border); display: flex; align-items: center; padding: 0 1.5rem; gap: 2rem; z-index: 100; }
  .footer-item { font-family: var(--font-mono); font-size: 0.65rem; color: var(--text-dim); }
  .footer-item span { color: var(--cyan); }

  .toast { position: fixed; bottom: 40px; right: 2rem; padding: 0.75rem 1.5rem; background: var(--bg2); border: 1px solid var(--green); color: var(--green); font-family: var(--font-mono); font-size: 0.8rem; z-index: 200; animation: fadeIn 0.3s ease; display: none; }
  .toast.error { border-color: var(--red); color: var(--red); }
  .toast.show { display: block; }
</style>
</head>
<body>

<nav>
  <div class="nav-logo">ER<span>OS</span></div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showPage('sos',this)">SOS</button>
    <button class="nav-tab" onclick="showPage('map',this)">Live Map</button>
    <button class="nav-tab" onclick="showPage('admin',this)">Admin</button>
    <button class="nav-tab" onclick="showPage('report',this)">Report</button>
  </div>
  <div class="status-dot" id="sysStatus">SYSTEM ONLINE</div>
</nav>

<!-- SOS -->
<div id="page-sos" class="page active">
  <div class="sos-container">
    <div class="sos-title">Emergency Response System</div>
    <div class="sos-btn-wrap">
      <div class="sos-ring"></div>
      <div class="sos-ring"></div>
      <div class="sos-ring"></div>
      <button class="sos-button" id="sosBtn" onclick="triggerSOS()">SOS</button>
    </div>
    <div class="sos-subtitle">TAP TO SEND EMERGENCY ALERT WITH YOUR GPS LOCATION</div>
    <div class="sos-alert" id="sosAlert">‚ö° SOS SIGNAL TRANSMITTED ‚Äî Location tagged. Nearest unit dispatched. ETA: ~4 min</div>
    <div class="sos-info-grid">
      <div class="sos-info-card">
        <div class="label">YOUR LOCATION</div>
        <div class="value" id="gpsStatus">Locating...</div>
      </div>
      <div class="sos-info-card">
        <div class="label">NEAREST UNIT</div>
        <div class="value">Unit 7</div>
      </div>
      <div class="sos-info-card">
        <div class="label">RESPONSE TIME</div>
        <div class="value">~4 min</div>
      </div>
    </div>
  </div>
</div>

<!-- MAP -->
<div id="page-map" class="page">
  <div class="map-layout">
    <div class="map-canvas" id="mapCanvas">
      <div class="map-grid"></div>
      <div class="map-roads">
        <svg viewBox="0 0 800 600" preserveAspectRatio="none">
          <line x1="0" y1="150" x2="800" y2="150" stroke="rgba(0,212,255,0.08)" stroke-width="12"/>
          <line x1="0" y1="350" x2="800" y2="350" stroke="rgba(0,212,255,0.08)" stroke-width="10"/>
          <line x1="200" y1="0" x2="200" y2="600" stroke="rgba(0,212,255,0.08)" stroke-width="10"/>
          <line x1="550" y1="0" x2="550" y2="600" stroke="rgba(0,212,255,0.08)" stroke-width="12"/>
          <line x1="0" y1="450" x2="800" y2="300" stroke="rgba(0,212,255,0.05)" stroke-width="8"/>
          <text x="400" y="295" fill="rgba(0,212,255,0.12)" font-family="Share Tech Mono" font-size="11" text-anchor="middle">LIVE INCIDENT MAP</text>
        </svg>
      </div>
    </div>
    <div class="map-sidebar">
      <div class="panel">
        <div class="panel-header">Active Incidents <span style="color:var(--red)" id="incCount">‚óè</span></div>
        <div class="panel-body" id="incidentList"><div style="color:var(--text-dim);font-family:var(--font-mono);font-size:0.8rem">Loading...</div></div>
      </div>
      <div class="panel">
        <div class="panel-header">Tag New Incident</div>
        <div class="panel-body">
          <div class="add-inc-form">
            <select id="incType">
              <option>Fire</option>
              <option>Medical Emergency</option>
              <option>Accident</option>
              <option>Crime</option>
              <option>Flood</option>
              <option>Other</option>
            </select>
            <select id="incPriority">
              <option value="critical">Critical</option>
              <option value="medium">Medium</option>
              <option value="low">Low</option>
            </select>
            <input type="text" id="incLocation" placeholder="Location description"/>
            <button class="btn-add" onclick="addIncident()">+ Tag Incident</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ADMIN -->
<div id="page-admin" class="page">
  <div class="admin-grid">
    <div class="stat-card c-red">
      <div class="stat-label">Active Incidents</div>
      <div class="stat-value" id="statActive">‚Äî</div>
      <div class="stat-sub">Live count</div>
    </div>
    <div class="stat-card c-orange">
      <div class="stat-label">Critical</div>
      <div class="stat-value" id="statCrit">‚Äî</div>
      <div class="stat-sub">Needs immediate response</div>
    </div>
    <div class="stat-card c-green">
      <div class="stat-label">SOS Today</div>
      <div class="stat-value" id="statSOS">‚Äî</div>
      <div class="stat-sub">Last 24 hours</div>
    </div>
    <div class="stat-card c-cyan">
      <div class="stat-label">Reports Today</div>
      <div class="stat-value" id="statReports">‚Äî</div>
      <div class="stat-sub">Anonymous submissions</div>
    </div>
  </div>
  <div class="admin-bottom">
    <div class="panel">
      <div class="panel-header">Priority Routing</div>
      <div class="panel-body">
        <div class="priority-bar-wrap">
          <div class="priority-bar-label"><span>Critical</span><span id="pctCrit">0%</span></div>
          <div class="priority-bar-track"><div class="priority-bar-fill" id="barCrit" style="width:0%;background:var(--red)"></div></div>
        </div>
        <div class="priority-bar-wrap">
          <div class="priority-bar-label"><span>Medium</span><span id="pctMed">0%</span></div>
          <div class="priority-bar-track"><div class="priority-bar-fill" id="barMed" style="width:0%;background:var(--orange)"></div></div>
        </div>
        <div class="priority-bar-wrap" style="margin-bottom:0">
          <div class="priority-bar-label"><span>Low</span><span id="pctLow">0%</span></div>
          <div class="priority-bar-track"><div class="priority-bar-fill" id="barLow" style="width:0%;background:var(--yellow)"></div></div>
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="panel-header">Recent Incidents</div>
      <div class="panel-body" style="padding:0">
        <table>
          <thead><tr><th>Time</th><th>Type</th><th>Priority</th><th>Status</th></tr></thead>
          <tbody id="adminTable"><tr><td colspan="4" style="text-align:center;color:var(--text-dim)">Loading...</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- REPORT -->
<div id="page-report" class="page">
  <div class="report-wrap">
    <div class="report-title">Anonymous Report</div>
    <div class="report-desc">Submit reports of harassment, safety concerns, or incidents anonymously. Your identity is never stored or shared.</div>
    <div class="anon-notice"><span>üîí</span> Your submission is fully anonymous. No personal data is collected or logged.</div>
    <br>
    <div id="reportForm" class="report-form">
      <div class="form-row">
        <div class="form-group">
          <label>Incident Type</label>
          <select id="rType">
            <option>Harassment</option>
            <option>Verbal Abuse</option>
            <option>Physical Threat</option>
            <option>Suspicious Activity</option>
            <option>Vandalism</option>
            <option>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Severity</label>
          <select id="rSeverity">
            <option>Low</option>
            <option>Medium</option>
            <option>High</option>
            <option>Critical</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Location / Area</label>
        <input type="text" id="rLocation" placeholder="e.g. Main Street near bus stop 12"/>
      </div>
      <div class="form-group">
        <label>Date & Time of Incident</label>
        <input type="datetime-local" id="rTime"/>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea rows="5" id="rDesc" placeholder="Describe what happened in as much detail as you feel comfortable sharing..."></textarea>
      </div>
      <button class="submit-btn" id="submitReportBtn" onclick="submitReport()">Submit Report Anonymously</button>
    </div>
    <div id="reportSuccess" class="report-success">
      <div class="success-icon">‚úì</div>
      <div style="font-family:var(--font-head);font-size:1.4rem;letter-spacing:3px;color:var(--green)">Report Submitted</div>
      <div style="color:var(--text-dim);font-size:0.85rem;margin-top:0.5rem">Your anonymous report has been received and will be reviewed.</div>
      <div class="success-id" id="reportId"></div>
      <br>
      <button class="submit-btn" onclick="resetReport()">Submit Another Report</button>
    </div>
  </div>
</div>

<div class="footer-bar">
  <div class="footer-item">EROS v1.0</div>
  <div class="footer-item">Incidents: <span id="footerInc">‚Äî</span></div>
  <div class="footer-item">DB: <span id="dbStatus">connecting...</span></div>
  <div class="footer-item" id="clock"></div>
</div>

<div class="toast" id="toast"></div>

<script>
const API = '';  // same origin ‚Äî empty means relative URLs

// ========== UTILS ==========
function showToast(msg, type='success') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `toast show${type==='error'?' error':''}`;
  setTimeout(() => t.classList.remove('show'), 3500);
}

async function apiFetch(path, options={}) {
  try {
    const res = await fetch(API + path, {
      headers: { 'Content-Type': 'application/json' },
      ...options
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Request failed');
    return data;
  } catch (err) {
    showToast(err.message, 'error');
    throw err;
  }
}

// ========== NAV ==========
function showPage(id, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  btn.classList.add('active');
  if (id==='map') loadMap();
  if (id==='admin') loadAdmin();
}

// ========== GPS ==========
let userLat = null, userLng = null;
function initGPS() {
  if (!navigator.geolocation) {
    document.getElementById('gpsStatus').textContent = 'GPS unavailable';
    return;
  }
  navigator.geolocation.getCurrentPosition(pos => {
    userLat = pos.coords.latitude;
    userLng = pos.coords.longitude;
    document.getElementById('gpsStatus').textContent = userLat.toFixed(3)+'¬∞, '+userLng.toFixed(3)+'¬∞';
  }, () => {
    document.getElementById('gpsStatus').textContent = 'Permission denied';
  });
}

// ========== SOS ==========
let sosCooldown = false;
async function triggerSOS() {
  if (sosCooldown) return;
  sosCooldown = true;
  const btn = document.getElementById('sosBtn');
  btn.disabled = true;
  btn.classList.add('triggered');
  try {
    await apiFetch('/api/sos', {
      method: 'POST',
      body: JSON.stringify({
        latitude: userLat,
        longitude: userLng,
        address: userLat ? `${userLat.toFixed(4)}, ${userLng.toFixed(4)}` : 'Unknown'
      })
    });
    document.getElementById('sosAlert').classList.add('show');
    showToast('üö® SOS transmitted. Help is on the way.');
    loadFooterCount();
  } catch(e) {
    sosCooldown = false;
    btn.disabled = false;
  }
  setTimeout(() => { btn.classList.remove('triggered'); }, 500);
  setTimeout(() => { sosCooldown = false; btn.disabled = false; }, 10000);
}

// ========== MAP ==========
async function loadMap() {
  try {
    const { data } = await apiFetch('/api/incidents');
    const canvas = document.getElementById('mapCanvas');
    canvas.querySelectorAll('.incident-pin').forEach(p => p.remove());
    const list = document.getElementById('incidentList');

    if (!data.length) {
      list.innerHTML = '<div style="color:var(--text-dim);font-family:var(--font-mono);font-size:0.8rem;padding:0.5rem">No active incidents</div>';
      return;
    }

    data.forEach(inc => {
      if (inc.status !== 'active') return;
      const pin = document.createElement('div');
      pin.className = `incident-pin pin-${inc.priority}`;
      pin.style.left = (inc.map_x || 50)+'%';
      pin.style.top = (inc.map_y || 50)+'%';
      pin.innerHTML = `<div class="pin-label">${inc.type}</div><div class="pin-dot"></div><div class="pin-ripple"></div>`;
      canvas.appendChild(pin);
    });

    const active = data.filter(i => i.status==='active');
    document.getElementById('incCount').textContent = `‚óè ${active.length}`;
    list.innerHTML = active.slice(0,8).map(inc => `
      <div class="incident-item">
        <div class="inc-type" style="color:${inc.priority==='critical'?'var(--red)':inc.priority==='medium'?'var(--orange)':'var(--yellow)'}">${inc.type}</div>
        <div class="inc-meta">${inc.location} ¬∑ ${new Date(inc.reported_at).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</div>
        <span class="inc-badge badge-${inc.priority}">${inc.priority.toUpperCase()}</span>
      </div>
    `).join('');
  } catch(e) {}
}

async function addIncident() {
  const type = document.getElementById('incType').value;
  const priority = document.getElementById('incPriority').value;
  const location = document.getElementById('incLocation').value.trim();
  if (!location) { showToast('Please enter a location', 'error'); return; }
  try {
    await apiFetch('/api/incidents', {
      method: 'POST',
      body: JSON.stringify({ type, priority, location })
    });
    document.getElementById('incLocation').value = '';
    showToast('Incident tagged successfully');
    loadMap();
    loadFooterCount();
  } catch(e) {}
}

// ========== ADMIN ==========
async function loadAdmin() {
  try {
    const { data: stats } = await apiFetch('/api/incidents/stats/summary');
    document.getElementById('statActive').textContent = stats.active;
    document.getElementById('statCrit').textContent = stats.critical;
    document.getElementById('statSOS').textContent = stats.sos_today;
    document.getElementById('statReports').textContent = stats.reports_today;

    const total = stats.active || 1;
    const pCrit = Math.round(stats.critical/total*100);
    const pMed = Math.round(stats.medium/total*100);
    const pLow = Math.round(stats.low/total*100);
    setTimeout(() => {
      document.getElementById('barCrit').style.width = pCrit+'%';
      document.getElementById('pctCrit').textContent = pCrit+'%';
      document.getElementById('barMed').style.width = pMed+'%';
      document.getElementById('pctMed').textContent = pMed+'%';
      document.getElementById('barLow').style.width = pLow+'%';
      document.getElementById('pctLow').textContent = pLow+'%';
    }, 100);

    const { data: incidents } = await apiFetch('/api/incidents');
    const tbody = document.getElementById('adminTable');
    if (!incidents.length) {
      tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-dim)">No incidents yet</td></tr>';
      return;
    }
    tbody.innerHTML = incidents.slice(0,8).map(inc => `
      <tr>
        <td>${new Date(inc.reported_at).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</td>
        <td>${inc.type}</td>
        <td><span class="inc-badge badge-${inc.priority}">${inc.priority.slice(0,4).toUpperCase()}</span></td>
        <td style="color:${inc.status==='resolved'?'var(--green)':inc.status==='active'?'var(--orange)':'var(--yellow)'}">${inc.status}</td>
      </tr>
    `).join('');
  } catch(e) {}
}

// ========== REPORT ==========
async function submitReport() {
  const type = document.getElementById('rType').value;
  const severity = document.getElementById('rSeverity').value;
  const location = document.getElementById('rLocation').value.trim();
  const time = document.getElementById('rTime').value;
  const desc = document.getElementById('rDesc').value.trim();
  if (!location || !desc) { showToast('Please fill in location and description', 'error'); return; }

  const btn = document.getElementById('submitReportBtn');
  btn.disabled = true;
  btn.textContent = 'Submitting...';

  try {
    const { data } = await apiFetch('/api/reports', {
      method: 'POST',
      body: JSON.stringify({ incident_type: type, severity, location, incident_time: time || null, description: desc })
    });
    document.getElementById('reportForm').style.display = 'none';
    document.getElementById('reportSuccess').classList.add('show');
    document.getElementById('reportId').textContent = 'Reference: ' + data.reference_id;
  } catch(e) {
    btn.disabled = false;
    btn.textContent = 'Submit Report Anonymously';
  }
}

function resetReport() {
  document.getElementById('reportForm').style.display = '';
  document.getElementById('reportSuccess').classList.remove('show');
  document.getElementById('submitReportBtn').disabled = false;
  document.getElementById('submitReportBtn').textContent = 'Submit Report Anonymously';
  document.getElementById('rLocation').value = '';
  document.getElementById('rDesc').value = '';
}

// ========== FOOTER ==========
async function loadFooterCount() {
  try {
    const { data } = await apiFetch('/api/incidents/stats/summary');
    document.getElementById('footerInc').textContent = data.active;
    document.getElementById('dbStatus').textContent = 'connected';
    document.getElementById('dbStatus').style.color = 'var(--green)';
  } catch(e) {
    document.getElementById('dbStatus').textContent = 'error';
    document.getElementById('dbStatus').style.color = 'var(--red)';
  }
}

function updateClock() {
  document.getElementById('clock').textContent = new Date().toLocaleTimeString();
}

// ========== INIT ==========
initGPS();
loadMap();
loadFooterCount();
setInterval(updateClock, 1000);
setInterval(loadFooterCount, 30000); // refresh every 30s
updateClock();
</script>
</body>
</html>
